<div class="mt-4 flex items-center justify-between">
    <!-- search input -->
    <div class="max-w-md">
        <label for="search" class="sr-only">Search</label>
        <div class="relative">
            <div
                class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400 dark:text-gray-500">
                <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd"
                        d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
                        clip-rule="evenodd" />
                </svg>
            </div>
            <input type="text" name="search" id="search" [ngModel]="searchQuery"
                (ngModelChange)="onSearchChange($event)"
                class="block w-full rounded-md border border-gray-300 bg-white py-2 pl-10 pr-3 text-sm placeholder-gray-400 focus:border-primary-500 focus:outline-none focus:ring-1 focus:ring-primary-500 sm:text-sm dark:bg-white/5 dark:border-white/10 dark:text-white dark:placeholder-gray-500 dark:focus:border-primary-light dark:focus:ring-primary-light"
                placeholder="Search leads" />
        </div>
    </div>
    <div class="flex items-center">
        <!-- three buttons -->
        <div class="relative">
            <button popovertarget="desktop-datatable-filter"
                class="gap-x-1 mt-4 mr-2 inline-flex items-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-xs inset-ring inset-ring-gray-300 hover:bg-gray-50 dark:bg-white/10 dark:text-white dark:inset-ring-white/10 dark:hover:bg-white/15">
                <span>Filters</span>
                <svg viewBox="0 0 20 20" fill="currentColor" data-slot="icon" aria-hidden="true" class="size-5">
                    <path
                        d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z"
                        clip-rule="evenodd" fill-rule="evenodd" />
                </svg>
            </button>
            <el-popover id="desktop-datatable-filter" anchor="bottom" popover
                class="w-screen max-w-max overflow-visible bg-transparent px-4 transition transition-discrete [--anchor-gap:--spacing(5)] backdrop:bg-transparent open:flex data-closed:translate-y-1 data-closed:opacity-0 data-enter:duration-200 data-enter:ease-out data-leave:duration-150 data-leave:ease-in">
                <app-filter-box [filterData]="filterData" (applyFilters)="onFilterChange($event)"></app-filter-box>
            </el-popover>
        </div>
        <button type="button"
            class="mt-4 mr-2 inline-flex items-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-xs inset-ring inset-ring-gray-300 hover:bg-gray-50 dark:bg-white/10 dark:text-white dark:inset-ring-white/10 dark:hover:bg-white/15">
            Export</button>
        <button type="button"
            class="mt-4 inline-flex items-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-xs inset-ring inset-ring-gray-300 hover:bg-gray-50 dark:bg-white/10 dark:text-white dark:inset-ring-white/10 dark:hover:bg-white/15">More
            Actions</button>
    </div>
</div>
<!-- start: TABLE -->
<div class="mt-8 flow-root">
    <div class="-mx-4 -my-2 overflow-x-auto sm:-mx-6 lg:-mx-8">
        <div class="inline-block min-w-full py-2 align-middle sm:px-6 lg:px-8">
            <div class="group/table relative">
                <div
                    class="absolute top-0 left-14 z-10 hidden h-12 items-center space-x-3 bg-white group-has-checked/table:flex sm:left-12 dark:bg-gray-900">
                    <button type="button"
                        class="inline-flex items-center rounded-sm bg-white px-2 py-1 text-sm font-semibold text-gray-900 shadow-xs inset-ring inset-ring-gray-300 hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-30 disabled:hover:bg-white dark:bg-white/10 dark:text-white dark:inset-ring-white/10 dark:hover:bg-white/15 dark:disabled:hover:bg-white/10">Bulk
                        edit</button>
                    <button type="button"
                        class="inline-flex items-center rounded-sm bg-white px-2 py-1 text-sm font-semibold text-gray-900 shadow-xs inset-ring inset-ring-gray-300 hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-30 disabled:hover:bg-white dark:bg-white/10 dark:text-white dark:inset-ring-white/10 dark:hover:bg-white/15 dark:disabled:hover:bg-white/10">Delete
                        all</button>
                </div>
                <table id="leads-table"
                    class="relative min-w-full table-fixed divide-y divide-gray-300 dark:divide-white/15">
                    <thead>
                        <tr>
                            @if (tableConfig.multiSelect) {
                            <th scope="col" class="relative px-7 sm:w-12 sm:px-6">
                                <div class="group absolute top-1/2 left-4 -mt-2 grid size-4 grid-cols-1">
                                    <input type="checkbox"
                                        class="col-start-1 row-start-1 appearance-none rounded-sm border border-gray-300 bg-white checked:border-indigo-600 checked:bg-indigo-600 indeterminate:border-indigo-600 indeterminate:bg-indigo-600 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 disabled:border-gray-300 disabled:bg-gray-100 disabled:checked:bg-gray-100 dark:border-white/20 dark:bg-gray-800/50 dark:checked:border-indigo-500 dark:checked:bg-indigo-500 dark:indeterminate:border-indigo-500 dark:indeterminate:bg-indigo-500 dark:focus-visible:outline-indigo-500 dark:disabled:border-white/10 dark:disabled:bg-gray-800 dark:disabled:checked:bg-gray-800 forced-colors:appearance-auto" />
                                    <svg viewBox="0 0 14 14" fill="none"
                                        class="pointer-events-none col-start-1 row-start-1 size-3.5 self-center justify-self-center stroke-white group-has-disabled:stroke-gray-950/25 dark:group-has-disabled:stroke-white/25">
                                        <path d="M3 8L6 11L11 3.5" stroke-width="2" stroke-linecap="round"
                                            stroke-linejoin="round" class="opacity-0 group-has-checked:opacity-100" />
                                        <path d="M3 7H11" stroke-width="2" stroke-linecap="round"
                                            stroke-linejoin="round"
                                            class="opacity-0 group-has-indeterminate:opacity-100" />
                                    </svg>
                                </div>
                            </th>
                            }
                            @for (column of columns; track column.field; let idx = $index) {
                            @if (!column.hidden) {
                            <th scope="col"
                                class="min-w-48 py-3.5 pr-3 text-left text-sm font-semibold text-gray-900 dark:text-white">
                                {{ column.label }}</th>
                            }
                            }
                            <th scope="col" class="py-3.5 pr-4 pl-3 sm:pr-3">
                                <span class="sr-only">Edit</span>
                            </th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200 bg-white dark:divide-white/10 dark:bg-gray-900">
                        @for (record of records; let idx = $index; track idx;) {
                        <tr class="group has-checked:bg-gray-50 dark:has-checked:bg-gray-800/50">
                            @if (tableConfig.multiSelect) {
                            <td class="relative px-7 sm:w-12 sm:px-6">
                                <div
                                    class="absolute inset-y-0 left-0 hidden w-0.5 bg-indigo-600 group-has-checked:block dark:bg-indigo-500">
                                </div>

                                <div class="group absolute top-1/2 left-4 -mt-2 grid size-4 grid-cols-1">
                                    <input type="checkbox"
                                        class="col-start-1 row-start-1 appearance-none rounded-sm border border-gray-300 bg-white checked:border-indigo-600 checked:bg-indigo-600 indeterminate:border-indigo-600 indeterminate:bg-indigo-600 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 disabled:border-gray-300 disabled:bg-gray-100 disabled:checked:bg-gray-100 dark:border-white/20 dark:bg-gray-800/50 dark:checked:border-indigo-500 dark:checked:bg-indigo-500 dark:indeterminate:border-indigo-500 dark:indeterminate:bg-indigo-500 dark:focus-visible:outline-indigo-500 dark:disabled:border-white/10 dark:disabled:bg-gray-800 dark:disabled:checked:bg-gray-800 forced-colors:appearance-auto" />
                                    <svg viewBox="0 0 14 14" fill="none"
                                        class="pointer-events-none col-start-1 row-start-1 size-3.5 self-center justify-self-center stroke-white group-has-disabled:stroke-gray-950/25 dark:group-has-disabled:stroke-white/25">
                                        <path d="M3 8L6 11L11 3.5" stroke-width="2" stroke-linecap="round"
                                            stroke-linejoin="round" class="opacity-0 group-has-checked:opacity-100" />
                                        <path d="M3 7H11" stroke-width="2" stroke-linecap="round"
                                            stroke-linejoin="round"
                                            class="opacity-0 group-has-indeterminate:opacity-100" />
                                    </svg>
                                </div>
                            </td>
                            }

                            @for (column of columns; track column.field) {
                            @if (!column.hidden) {
                            @if (column.cellTemplate === 'link' && column.hrefField) {
                                <td class="px-3 py-3 text-sm whitespace-nowrap text-gray-500 dark:text-gray-400">
                                    <a [routerLink]="getColumnTemplateRouterLink(column.hrefField, record, [tableConfig.rowReferenceField])" class="font-semibold text-gray-600 hover:underline cursor-pointer">{{ record[column.field] }}</a>
                                </td>
                            }
                            @else if(column.cellTemplate === 'datetime') {
                                <td class="px-3 py-3 text-sm whitespace-nowrap text-gray-500 dark:text-gray-400">
                                    {{ record[column.field] | date:'short' }}</td>

                            }
                            @else if (column.cellTemplate === 'color-badge') {
                                <td>
                                    <span class="inline-flex items-center rounded-md px-2 py-1 text-xs font-medium"
                                    [ngClass]="{ 
                                        'text-blue-600 bg-blue-50 inset-ring inset-ring-blue-500/10': column.colorBadgeMapper?.[record[column.field]] === 'blue',
                                        'text-orange-600 bg-orange-50 inset-ring inset-ring-orange-500/10': column.colorBadgeMapper?.[record[column.field]] === 'orange',
                                        'text-teal-600 bg-teal-50 inset-ring inset-ring-teal-500/10': column.colorBadgeMapper?.[record[column.field]] === 'teal',
                                        'text-green-600 bg-green-50 inset-ring inset-ring-green-500/10': column.colorBadgeMapper?.[record[column.field]] === 'green',
                                        'text-red-600 bg-red-50 inset-ring inset-ring-red-500/10': column.colorBadgeMapper?.[record[column.field]] === 'red',
                                         }">
                                        {{ getDisplayedValue(column, record[column.field]) }}</span>
                                </td>
                            }
                            @else {
                                <td class="px-3 py-3 text-sm whitespace-nowrap text-gray-500 dark:text-gray-400">
                                    {{ getDisplayedValue(column, record[column.field]) }}</td>
                            }
                            }
                            }
                            <td class="py-3 pr-4 pl-3 whitespace-nowrap sm:pr-3">
                                <el-dropdown class="inline-block">
                                    <button
                                        class="flex items-center rounded-full text-gray-400 hover:text-gray-600 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 dark:text-gray-400 dark:hover:text-gray-300 dark:focus-visible:outline-indigo-500">
                                        <span class="sr-only">Open options</span>
                                        <svg viewBox="0 0 20 20" fill="currentColor" data-slot="icon" aria-hidden="true"
                                            class="size-5">
                                            <path
                                                d="M10 3a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM10 8.5a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM11.5 15.5a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0Z" />
                                        </svg>
                                    </button>

                                    <el-menu anchor="bottom end" popover
                                        class="w-48 origin-top-right rounded-md bg-white shadow-lg outline-1 outline-black/5 transition transition-discrete [--anchor-gap:--spacing(2)] data-closed:scale-95 data-closed:transform data-closed:opacity-0 data-enter:duration-100 data-enter:ease-out data-leave:duration-75 data-leave:ease-in dark:bg-gray-800 dark:shadow-none dark:-outline-offset-1 dark:outline-white/10">
                                        <div class="py-1">
                                            @for (action of rowActions; let aidx = $index; track aidx;) {
                                            <a (click)="action.actionCallback(record)"
                                                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 focus:bg-gray-100 focus:text-gray-900 focus:outline-hidden dark:text-gray-300 dark:focus:bg-white/5 dark:focus:text-white">{{ action.label }}</a>
                                            }
                                        </div>
                                    </el-menu>
                                </el-dropdown>
                            </td>
                        </tr>
                        }
                    </tbody>
                </table>
                
                <!-- No Data Placeholder -->
                @if (records.length === 0 && !loading) {
                <div class="text-center py-12">
                    <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <h3 class="mt-2 text-sm font-semibold text-gray-900 dark:text-gray-100">{{ emptyStateTitle }}</h3>
                    <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">
                        @if (searchQuery) {
                        No results match your search query "{{ searchQuery }}". Try adjusting your search terms.
                        }
                        @else {
                        {{ emptyStateMessage }}
                        }
                    </p>
                    @if (!searchQuery && showAddButton) {
                    <div class="mt-6">
                        <button type="button" (click)="onAddButtonClick()" class="inline-flex items-center rounded-md bg-primary-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-primary-500 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-600">
                            <svg class="-ml-0.5 mr-1.5 h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
                            </svg>
                            {{ addButtonLabel }}
                        </button>
                    </div>
                    }
                </div>
                }
                
                <!-- Loading Placeholder -->
                @if (loading) {
                <div class="text-center py-12">
                    <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"></div>
                    <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Loading data...</p>
                </div>
                }
                
                @if (totalRecords > 0) {
                <app-table-pagination [currentPage]="currentPage" [pageSize]="pageSize" [totalRecords]="totalRecords"
                    (pageChange)="onPageChange($event)"></app-table-pagination>
                }
            </div>
        </div>
    </div>
</div>
<!-- end: TABLE -->