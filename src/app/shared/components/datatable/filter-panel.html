<!-- This is the filter panel template to be integrated into datatable.component.html -->
@if (showFilters() && config.filters && config.filters.length > 0) {
  <div class="mt-4 border-t border-gray-200 pt-4 dark:border-gray-700">
    <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3">
      @for (filter of config.filters; track filter.key) {
        <div>
          <label [for]="'filter-' + filter.key" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
            {{ filter.label }}
          </label>
          
          <!-- Select Filter -->
          @if (filter.type === 'select') {
            <select
              [id]="'filter-' + filter.key"
              [value]="filterValues()[filter.key] || ''"
              (change)="onFilterChange(filter.key, ($any($event.target)).value)"
              class="block w-full rounded-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-primary-600 sm:text-sm dark:bg-white/5 dark:text-white dark:ring-gray-700">
              <option value="">{{ filter.placeholder || 'Select...' }}</option>
              @for (option of filter.options; track option.value) {
                <option [value]="option.value">{{ option.label }}</option>
              }
            </select>
          }

          <!-- Multi-select Filter with Popover -->
          @if (filter.type === 'multiselect') {
            <el-popover [id]="'filter-popover-' + filter.key" anchor="bottom start" popover
              class="w-64 origin-top-left rounded-md bg-white p-4 shadow-2xl ring-1 ring-black/5 transition transition-discrete [--anchor-gap:--spacing(2)] backdrop:bg-transparent focus:outline-hidden data-closed:scale-95 data-closed:transform data-closed:opacity-0 data-enter:duration-100 data-enter:ease-out data-leave:duration-75 data-leave:ease-in dark:bg-gray-800 dark:ring-white/10">
              <div class="space-y-3 max-h-64 overflow-y-auto">
                @for (option of filter.options; track option.value) {
                  <div class="flex gap-3">
                    <div class="flex h-5 shrink-0 items-center">
                      <div class="group grid size-4 grid-cols-1">
                        <input
                          [id]="'filter-' + filter.key + '-' + option.value"
                          type="checkbox"
                          [checked]="(filterValues()[filter.key] || []).includes(option.value)"
                          (change)="onMultiselectChange(filter.key, option.value, ($any($event.target)).checked)"
                          class="col-start-1 row-start-1 appearance-none rounded-sm border border-gray-300 bg-white checked:border-indigo-600 checked:bg-indigo-600 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 dark:border-gray-600 dark:bg-gray-700" />
                        <svg viewBox="0 0 14 14" fill="none" class="pointer-events-none col-start-1 row-start-1 size-3.5 self-center justify-self-center stroke-white">
                          <path d="M3 8L6 11L11 3.5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="opacity-0 group-has-checked:opacity-100" />
                        </svg>
                      </div>
                    </div>
                    <label [for]="'filter-' + filter.key + '-' + option.value" class="text-sm font-medium text-gray-900 dark:text-gray-200">
                      {{ option.label }}
                    </label>
                  </div>
                }
              </div>
            </el-popover>
            <button
              [attr.popovertarget]="'filter-popover-' + filter.key"
              type="button"
              class="inline-flex w-full justify-between items-center rounded-md bg-white px-3 py-1.5 text-sm text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 dark:bg-white/5 dark:text-white dark:ring-gray-700 dark:hover:bg-white/10">
              <span>
                @if ((filterValues()[filter.key] || []).length === 0) {
                  {{ filter.placeholder || 'Select...' }}
                } @else {
                  {{ (filterValues()[filter.key] || []).length }} selected
                }
              </span>
              <svg viewBox="0 0 20 20" fill="currentColor" class="size-5 text-gray-400">
                <path d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" fill-rule="evenodd" />
              </svg>
            </button>
          }

          <!-- Date Filter -->
          @if (filter.type === 'date') {
            <input
              [id]="'filter-' + filter.key"
              type="date"
              [value]="filterValues()[filter.key] || ''"
              (change)="onFilterChange(filter.key, ($any($event.target)).value)"
              class="block w-full rounded-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-primary-600 sm:text-sm dark:bg-white/5 dark:text-white dark:ring-gray-700" />
          }

          <!-- Date Range Filter -->
          @if (filter.type === 'daterange') {
            <div class="flex gap-2">
              <input
                [id]="'filter-' + filter.key + '-start'"
                type="date"
                [value]="filterValues()[filter.key]?.start || ''"
                (change)="onDateRangeChange(filter.key, 'start', ($any($event.target)).value)"
                placeholder="Start"
                class="block w-full rounded-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-primary-600 sm:text-sm dark:bg-white/5 dark:text-white dark:ring-gray-700" />
              <input
                [id]="'filter-' + filter.key + '-end'"
                type="date"
                [value]="filterValues()[filter.key]?.end || ''"
                (change)="onDateRangeChange(filter.key, 'end', ($any($event.target)).value)"
                placeholder="End"
                class="block w-full rounded-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-primary-600 sm:text-sm dark:bg-white/5 dark:text-white dark:ring-gray-700" />
            </div>
          }

          <!-- Text Filter -->
          @if (filter.type === 'text') {
            <input
              [id]="'filter-' + filter.key"
              type="text"
              [value]="filterValues()[filter.key] || ''"
              (input)="onFilterChange(filter.key, ($any($event.target)).value)"
              [placeholder]="filter.placeholder || ''"
              class="block w-full rounded-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-primary-600 sm:text-sm dark:bg-white/5 dark:text-white dark:ring-gray-700" />
          }

          <!-- Number Filter -->
          @if (filter.type === 'number') {
            <input
              [id]="'filter-' + filter.key"
              type="number"
              [value]="filterValues()[filter.key] || ''"
              (input)="onFilterChange(filter.key, ($any($event.target)).value)"
              [placeholder]="filter.placeholder || ''"
              class="block w-full rounded-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-primary-600 sm:text-sm dark:bg-white/5 dark:text-white dark:ring-gray-700" />
          }
        </div>
      }
    </div>
    
    <!-- Action Buttons -->
    <div class="mt-4 flex items-center gap-2">
      <button
        (click)="onApplyFilters()"
        type="button"
        class="inline-flex items-center rounded-md bg-primary-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-primary-500 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-600 dark:bg-primary-500 dark:hover:bg-primary-400">
        Apply Filters
      </button>
      <button
        (click)="onClearFilters()"
        type="button"
        class="inline-flex items-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 dark:bg-gray-700 dark:text-white dark:ring-gray-600 dark:hover:bg-gray-600">
        Clear
      </button>
    </div>
  </div>
}
